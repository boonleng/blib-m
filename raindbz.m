% raindbz.m
%
% A script to generate a simple plot of radar sensitivity for various
% system configurations.
%
% Created by Boon Leng Cheong.
% Copyright (c) 2012 Boon Leng Cheong. All rights reserved.
%

clf

particle = 'rain';
% particle = 'snow';

% Plot the sensitivity curves up to r (km)
% r = 150;
r = 60;

% Special evaluation at range R
R = 50e3;
%R = 25e3;
%R = 150e3;

% The speed of light
c = 299792458;

% Waveform efficiency:
%    - 1.0;  % 100% efficient
%    - 0.9;  % Maximum in practice
%    - 0.7;  % Conservative
%    - 0.31; % Taylor window

% Y-axis limit to show
% ylim = [-15, 75];
ylim = [-5, 60];

if ~exist('xscale','var'), xscale = 'linear'; end

cat_str = {'Trace / light snow / gust front (No rain)',...
	       'Light rain / moderate to heavy snow',...
	       'Moderate rain or sleet showers',...
	       'Moderate to heavy rain or sleet showers',...
	       'Heavy thunderstorms',...
	       'Intense to severe thunderstorms with hail'};
n = numel(cat_str);
catlo = 12.8 : 10 : 65;
if strcmp(particle, 'rain')
	K = sqrt(0.93);
elseif strcmp(particle, 'snow')
	K = sqrt(0.176);
else
	fprintf('Unknown particle %s\n', particle)
	return;
end

cc = kron(catlo, [1, 1, nan]);

clf

% Background
hbg = axes;
zmap = blib('zmap');
zmap = zmap(2:end, :);
tmp = rgb2hsv(get(gcf, 'color'));
fig_brightnenss = tmp(3);
if fig_brightnenss > 0.5
	zmap = 0.4 * zmap + 0.6 * ones(size(zmap));
else
	zmap = 0.6 * zmap;
end
% Compensate y-axis for the 0.5-pixel boundary w/ imagesc()
dy = 0.25;
yy = kron((1:size(zmap, 1)).', ones(5 / dy, 1));
ind = repmat(yy, [1, 2]);
imrgb = ind2rgb(ind, zmap);
image([0.001, r], (0 : numel(yy) - 1) * dy + 0.5 * dy, imrgb);

% Foreground
pos = get(gca, 'Position');
hfg = axes('position', pos);

lp = linkprop([hbg, hfg], {'XLim', 'YLim'});

hold on

NF = 10 ^ (3.0 / 10);       % Noise Figure
rr = 1e3 * (1:0.5:r);

fprintf(['*****************\n',...
         '*    Z M I N    *\n',...
         '*****************\n\n']);
fprintf('Evaluating at range = %.2f km\n\n',1e-3*R);

radars = [];

% radar = struct('name', '500kW 0.8us (OU-PRIME)', ...   % Description
%   'Pmin', 10^(-112/10), ...                            % Minimum detetable signal of the RX in mW (dBm)
%   'lambda', 3e8/5510e6, ...                            % wavelength in meters
%   'Pt', 500e6, ...                                     % TX power in mW (10 ^ 0.1 * (power in dBm))
%   'G', 10^(50/10), ...                                 % Antenna gain (10 ^ 0.1 * (gain in dBi))
%   'theta', 0.45/180*pi, ...                            % Antenna resolution (radian)
%   'PW', 0.8e-6, ...                                    % PW in sec
%   'L', 10^(3.5/10), ...                                % System loss
%   'attrib', []);                                       % Plot attributes, can be empty
% radars = radar;

% radars = cat(1, radars, struct('name', '750kW 1.57us (WSR-88D)',         'Pmin', 10^(-112/10), 'lambda', 3e8/2.7e9, 'Pt', 750e6,           'G', 10^(43/10), 'theta', 1.0/180*pi, 'PW', 1.57e-6, 'L', 10^(1/10), 'attrib', struct('Color', [1, 0, 0])));

% line_color = [0 0.3 1.0];
% radars = cat(1, radars, struct('name', 'PX-10k 800W 67us',               'Pmin', 10^(-110/10), 'lambda', 0.0314,    'Pt', 800e3 * wav_eff, 'G', 10^(42/10), 'theta', 1.4/180*pi, 'PW',   67e-6, 'L', 10^(2/10), 'attrib', struct('Color', line_color)));
% radars = cat(1, radars, struct('name', 'PX-10k 800W 1.5us (Fill Pulse)', 'Pmin', 10^(-110/10), 'lambda', 0.0314,    'Pt', 800e3 * wav_eff, 'G', 10^(42/10), 'theta', 1.4/180*pi, 'PW',  1.5e-6, 'L', 10^(2/10), 'attrib', struct('Color', line_color)));

% line_color = [0 0.7 0.6];
% radars = cat(1, radars, struct('name', 'PC-10k 800W 67us',               'Pmin', 10^(-110/10), 'lambda', 0.0500,    'Pt', 800e3 * wav_eff, 'G', 10^(42/10), 'theta', 2.8/180*pi, 'PW',   67e-6, 'L', 10^(2/10), 'attrib', struct('Color', line_color, 'LineWidth', 1.5)));
% radars = cat(1, radars, struct('name', 'PC-10k 800W 1.5us (Fill Pulse)', 'Pmin', 10^(-110/10), 'lambda', 0.0500,    'Pt', 800e3 * wav_eff, 'G', 10^(42/10), 'theta', 2.8/180*pi, 'PW',   67e-6, 'L', 10^(2/10), 'attrib', struct('Color', line_color, 'LineWidth', 1.5)));

% radars = cat(1, radars, struct('name', 'PX1k 200W 67us',               'Pmin', 10^(-110/10), 'lambda', 0.0314,    'Pt', 200e3 * wav_eff, 'G', 10^(38/10), 'theta', 1.8/180*pi, 'PW',   67e-6, 'L', 10^(2/10), 'attrib', struct('Color', line_color, 'LineWidth', 1.5)));
% radars = cat(1, radars, struct('name', 'PX1k 200W 1.5us (Fill Pulse)', 'Pmin', 10^(-110/10), 'lambda', 0.0314,    'Pt', 200e3 * wav_eff, 'G', 10^(38/10), 'theta', 1.8/180*pi, 'PW',  1.5e-6, 'L', 10^(2/10), 'attrib', struct('Color', line_color, 'LineWidth', 1.5)));

% The following set of four radars all have the same radar hardware configurations 
L = 10 ^ (2 / 10);
G_ant = 10 ^ (38 / 10);
theta = 1.8 / 180 * pi;
lambda = 0.0314;
pw_hi = 67e-6;
pw_lo = 1.5e-6;
if ~exist('label_odd_index_only', 'var')
    label_odd_index_only = true;
end

% Kaisser Window with 3.19-dB SNR loss
line_color = [0 0.3 1.0];
wav_eff = 1.0 / 10 ^ (3.19 / 10);
radars = cat(1, radars, struct('name', '70 dB Kaiser LFM',               'Pmin', 10^(-110/10), 'lambda', lambda,    'Pt', 100e3 * wav_eff, 'G', G_ant, 'theta', theta, 'PW', pw_hi, 'L', L, 'attrib', struct('Color', line_color, 'LineWidth', 1.5, 'LineStyle', ':')));
radars = cat(1, radars, struct('name', '70 dB Kaiser LFM (Fill Pulse)',  'Pmin', 10^(-110/10), 'lambda', lambda,    'Pt', 100e3 * wav_eff, 'G', G_ant, 'theta', theta, 'PW', pw_lo, 'L', L, 'attrib', struct('Color', line_color, 'LineWidth', 1.5, 'LineStyle', ':')));

% Nuttall Window with 2.96-dB SNR loss
line_color = [1.0, 0.3, 0.2];
wav_eff = 1.0 / 10 ^ (2.96 / 10);
radars = cat(1, radars, struct('name', 'De Witte and Griffiths 2004',              'Pmin', 10^(-110/10), 'lambda', lambda,    'Pt', 100e3 * wav_eff, 'G', G_ant, 'theta', theta, 'PW', pw_hi, 'L', L, 'attrib', struct('Color', line_color, 'LineWidth', 1.5, 'LineStyle', '-.')));
radars = cat(1, radars, struct('name', 'De Witte and Griffiths 2004 (Fill Pulse)', 'Pmin', 10^(-110/10), 'lambda', lambda,    'Pt', 100e3 * wav_eff, 'G', G_ant, 'theta', theta, 'PW', pw_lo, 'L', L, 'attrib', struct('Color', line_color, 'LineWidth', 1.5, 'LineStyle', '-.')));

% Optimized LFM with 0.24-dB SNR loss
line_color = [0.0, 0.7, 0.6];
wav_eff = 1.0 / 10 ^ (0.24 / 10);
radars = cat(1, radars, struct('name', 'Optimized LFM',                  'Pmin', 10^(-110/10), 'lambda', lambda,    'Pt', 100e3 * wav_eff, 'G', G_ant, 'theta', theta, 'PW', pw_hi, 'L', L, 'attrib', struct('Color', line_color, 'LineWidth', 2.0)));
radars = cat(1, radars, struct('name', 'Optimized LFM (Fill Pulse)',     'Pmin', 10^(-110/10), 'lambda', lambda,    'Pt', 100e3 * wav_eff, 'G', G_ant, 'theta', theta, 'PW', pw_lo, 'L', L, 'attrib', struct('Color', line_color, 'LineWidth', 2.0)));

% Perfect ideal world that we cannot get to ... :(
wav_eff = 1.0;
line_color = [0.0, 0.0, 0.0];
radars = cat(1, radars, struct('name', 'Non-Windowed LFM',               'Pmin', 10^(-110/10), 'lambda', lambda,    'Pt', 100e3 * wav_eff, 'G', G_ant, 'theta', theta, 'PW', pw_hi, 'L', L, 'attrib', struct('Color', line_color, 'LineWidth', 1.5, 'LineStyle', '--')));
radars = cat(1, radars, struct('name', 'Non-Windowed LFM (Fill Pulse)',  'Pmin', 10^(-110/10), 'lambda', lambda,    'Pt', 100e3 * wav_eff, 'G', G_ant, 'theta', theta, 'PW', pw_lo, 'L', L, 'attrib', struct('Color', line_color, 'LineWidth', 1.5, 'LineStyle', '--')));

% radar = struct('name', '375kW 1.57us (WSR-88D)', ... 
% 	'Pmin', 10^(-112/10), ...
% 	'lambda', 3e8/2.7e9, ...
% 	'Pt', 375e6, ...
% 	'G', 10^(43/10), ...
% 	'theta', 1.0/180*pi, ...
% 	'PW', 1.57e-6, ...
% 	'L', 10^(1/10), ...
% 	'attrib', []);
% radars = cat(1, radars, radar);


% radar = struct('name', '250kW 1.57us (Klystron)', ... 
% 	'Pmin', 10^(-112/10), ...
% 	'lambda', 3e8/2.7e9, ...
% 	'Pt', 250e6, ...
% 	'G', 10^(43/10), ...
% 	'theta', 1.0/180*pi, ...
% 	'PW', 1.57e-6, ...
% 	'L', 10^(1/10), ...
% 	'attrib', struct('Color', [0 0.7 0.0]));
% radars = cat(1, radars, radar);

% radar = struct('name', 'Toshiba (100us)', ... 
% 	'Pmin', 10^(-112/10), ...
% 	'lambda', 3e8/2.7e9, ...
% 	'Pt', 5e6, ...
% 	'G', 10^(45/10), ...
% 	'theta', 1.0/180*pi, ...
% 	'PW', 100e-6, ...
% 	'L', 10^(1/10), ...
% 	'attrib', struct('Color', [1 0.2 0.7]));
% radars = cat(1, radars, radar);

% radar = struct('name', 'Toshiba (Fill, 2us)', ... 
% 	'Pmin', 10^(-112/10), ...
% 	'lambda', 3e8/2.7e9, ...
% 	'Pt', 5e6, ...
% 	'G', 10^(45/10), ...
% 	'theta', 1.0/180*pi, ...
% 	'PW', 2e-6, ...
% 	'L', 10^(1/10), ...
% 	'attrib', struct('Color', [1 0.2 0.7]));
% radars = cat(1, radars, radar);


% radar = struct('name', '5kW 0.5us (CASA IP-1)', ... 
% 	'Pmin', 10^(-110/10), ...
% 	'lambda', 0.0319, ...
% 	'Pt', 5.2e6, ...
% 	'G', 10^(37/10), ...
% 	'theta', 1.8/180*pi, ...
% 	'PW', 0.46e-6, ...
% 	'L', 10^(1/10), ...
% 	'attrib', struct('Color', [0 0.7 0]));
% radars = cat(1, radars, radar);

% line_color = [1 0.3 1];

% radar = struct('name', '475kW 1.57us (Some Dish)', ... 
% 	'Pmin', 10^(-113/10), ...
% 	'lambda', 0.10, ...
% 	'Pt', 475e6, ...
% 	'G', 10^(46.21/10), ...
% 	'theta', 0.85/180*pi, ...
% 	'PW', 1.57e-6, ...
% 	'L', 10^(0/10), ...
% 	'attrib', struct('Color', line_color, 'LineWidth', 1.5));
% radars = cat(1, radars, radar);


% radar = struct('name', '1.5kW 15us (PX-1000 TWT)', ... 
% 	'Pmin', 10^(-110/10), ...
% 	'lambda', 0.0314, ...
% 	'Pt', 1.5e6, ...
% 	'G', 10^(38.5/10), ...
% 	'theta', 1.8/180*pi, ...
% 	'PW', 15e-6, ...
% 	'L', 10^(3/10), ...
% 	'attrib', []);
% radars = cat(1, radars, radar);


%line_color = [1 1 0];
%line_color = [0.3 0.8 1];
line_color = [0 0.3 1];

% radar = struct('name', 'PX-1000 100W 67us', ... 
% 	'Pmin', 10^(-110/10), ...
% 	'lambda', 0.0314, ...
% 	'Pt', 100e3 * wav_eff, ...
%     'G', 10^(38.5/10), ...
% 	'theta', 1.8/180*pi, ...
% 	'PW', 67e-6, ...
% 	'L', 10^(3/10), ...
% 	'attrib', struct('Color', line_color, 'LineWidth', 1.5));
% radars = cat(1, radars, radar);
% 
% radar = struct('name', 'PX-1000 100W 2us (Fill Pulse)', ... 
% 	'Pmin', 10^(-110/10), ...
% 	'lambda', 0.0314, ...
% 	'Pt', 100e3 * wav_eff, ... % 90% efficient waveform, ...
% 	'G', 10^(38.5/10), ...
% 	'theta', 1.8/180*pi, ...
% 	'PW', 2e-6, ...  % Window efficiency
% 	'L', 10^(3/10), ...
% 	'attrib', struct('Color', line_color, 'LineWidth', 1.5));
% radars = cat(1, radars, radar);

% radar = struct('name', 'PX-1000 200W 67us', ... 
% 	'Pmin', 10^(-110/10), ...
% 	'lambda', 0.0314, ...
% 	'Pt', 200e3 * wav_eff, ...
%     'G', 10^(38.5/10), ...
% 	'theta', 1.8/180*pi, ...
% 	'PW', 67e-6, ...
% 	'L', 10^(3/10), ...
% 	'attrib', struct('Color', line_color, 'LineWidth', 1.5));
% radars = cat(1, radars, radar);
% 
% radar = struct('name', 'PX-1000 200W 2us (Fill Pulse)', ... 
% 	'Pmin', 10^(-110/10), ...
% 	'lambda', 0.0314, ...
% 	'Pt', 200e3 * wav_eff, ...
% 	'G', 10^(38.5/10), ...
% 	'theta', 1.8/180*pi, ...
% 	'PW', 2e-6, ...  % Window efficiency
% 	'L', 10^(3/10), ...
% 	'attrib', struct('Color', line_color, 'LineWidth', 1.5));
% radars = cat(1, radars, radar);

% 
% radar = struct('name', '100W 67us', ... 
% 	'Pmin', 10^(-110/10), ...
% 	'lambda', 0.0314, ...
% 	'Pt', 0.31*0.1e6, ... % A factor of 0.31 from kaiser windowing
% 	'G', 10^(38.5/10), ...
% 	'theta', 1.8/180*pi, ...
% 	'PW', 67e-6, ...
% 	'L', 10^(3/10), ...
% 	'attrib', struct('Color', line_color, 'LineWidth', 1.5));
% radars = cat(1, radars, radar);


% radar = struct('name', '100W 2us (Windowed Fill Pulse)', ... 
% 	'Pmin', 10^(-110/10), ...
% 	'lambda', 0.0314, ...
% 	'Pt', 0.1e6, ...
% 	'G', 10^(38.5/10), ...
% 	'theta', 1.8/180*pi, ...
% 	'PW', 2e-6 * 0.394, ...  % Window efficiency
% 	'L', 10^(3/10), ...
% 	'attrib', struct('Color', line_color, 'LineWidth', 1.5));
% radars = cat(1, radars, radar);

% radar = struct('name', '100W 67us (WL)', ... 
% 	'Pmin', 10^(-110/10), ...
% 	'lambda', 0.0314, ...
% 	'Pt', 0.1e6, ...
% 	'G', 10^(46/10), ...
% 	'theta', 1.0/180*pi, ...
% 	'PW', 67e-6, ...
% 	'L', 10^(3/10), ...
% 	'attrib', struct('Color', line_color, 'LineWidth', 1.5));
% radars = cat(1, radars, radar);
% 
% radar = struct('name', '100W 2us (WL)', ... 
% 	'Pmin', 10^(-110/10), ...
% 	'lambda', 0.0314, ...
% 	'Pt', 0.1e6, ...
% 	'G', 10^(46/10), ...
% 	'theta', 1.0/180*pi, ...
% 	'PW', 2e-6, ...
% 	'L', 10^(3/10), ...
% 	'attrib', struct('Color', line_color, 'LineWidth', 1.5));
% radars = cat(1, radars, radar);

% line_color = [0 0.3 1];

% radar = struct('name', 'PX-1000 200W 67us', ... 
% 	'Pmin', 10^(-110/10), ...
% 	'lambda', 0.0314, ...
% 	'Pt', 200e3 * wav_eff, ...
%     'G', 10^(38.5/10), ...
% 	'theta', 1.8/180*pi, ...
% 	'PW', 67e-6, ...
% 	'L', 10^(3/10), ...
% 	'attrib', struct('Color', line_color, 'LineWidth', 1.5));
% radars = cat(1, radars, radar);
% 
% radar = struct('name', 'PX-1000 200W 2us (Fill Pulse)', ... 
% 	'Pmin', 10^(-110/10), ...
% 	'lambda', 0.0314, ...
% 	'Pt', 200e3 * wav_eff, ... % waveform, ...
% 	'G', 10^(38.5/10), ...
% 	'theta', 1.8/180*pi, ...
% 	'PW', 2e-6, ...  % Window efficiency
% 	'L', 10^(3/10), ...
% 	'attrib', struct('Color', line_color, 'LineWidth', 1.5));
% radars = cat(1, radars, radar);


% Antenna gain = 10 * log10 (32400 / theta / phi * 0.65 (efficiency))

% radar = struct('name', 'Ranger (1m)', ... 
% 	'Pmin', 10^(-110/10), ...
% 	'lambda', 0.0314, ...
% 	'Pt', 0.1e6 * eff, ...
% 	'G', 10^(37/10), ...
% 	'theta', 2.0/180*pi, ...
% 	'PW', 67e-6, ...
% 	'L', 10^(3/10), ...
% 	'attrib', struct('Color', [1 0.3 0.7], 'LineWidth', 1.5));
% radars = cat(1, radars, radar);
% 
% radar = struct('name', 'Ranger (1m, Fill pulse)', ... 
% 	'Pmin', 10^(-110/10), ...
% 	'lambda', 0.0314, ...
% 	'Pt', 0.1e6 * wav_eff, ...
% 	'G', 10^(37/10), ...
% 	'theta', 2.0/180*pi, ...
% 	'PW', 2e-6, ...
% 	'L', 10^(3/10), ...
% 	'attrib', struct('Color', [1 0.3 0.7], 'LineWidth', 1.5));
% radars = cat(1, radars, radar);

% radar = struct('name', 'NOXP 250kW 1us', ...
% 	'Pmin', 10^(-110/10), ...
% 	'lambda', 3e8/9415e6, ...
% 	'Pt', 125e6 * wav_eff, ...  % 250W split between H & V
% 	'G', 10^(44.5/10), ...  % In theory, 44.5
% 	'theta', 0.9/180*pi, ...
% 	'PW', 1e-6, ...
% 	'L', 10^(3/10), ...
% 	'attrib', struct('Color', [1 0.3 0.7], 'LineWidth', 1.5));
% radars = cat(1, radars, radar);
    
% line_color = [0.9 0.6 0];
% 
% radar = struct('name', 'PX-10k 1,200W 67us', ... 
% 	'Pmin', 10^(-110/10), ...
% 	'lambda', 0.0314, ...
% 	'Pt', 1200e3 * wav_eff, ...
%     'G', 10^(42.4/10), ...  % H-port
% 	'theta', 1.4/180*pi, ...
% 	'PW', 67e-6, ...
% 	'L', 10^(3/10), ...
% 	'attrib', struct('Color', line_color, 'LineWidth', 1.5));
% radars = cat(1, radars, radar);
% 
% radar = struct('name', 'PX-10k 1,200W 2us (Fill Pulse)', ... 
% 	'Pmin', 10^(-110/10), ...
% 	'lambda', 0.0314, ...
% 	'Pt', 1200e3 * wav_eff, ... % < 100% waveform, ...
% 	'G', 10^(42.4/10), ...
% 	'theta', 1.4/180*pi, ...
% 	'PW', 2e-6, ...  % Window efficiency
% 	'L', 10^(3/10), ...
% 	'attrib', struct('Color', line_color, 'LineWidth', 1.5));
% radars = cat(1, radars, radar);

% Going through the cases
zz = zeros(numel(radars), numel(rr));

% Censoring SNR in dB
cen = 0;

for ir = 1:numel(radars)
	radar = radars(ir);

	TL = 1 / (NF * radar.L);  % Assume 1-dB atmospheric factor, attenuate Pt, so L should actually be 1/L
    
	%Zmin = (Pmin*1024*log(2)*lambda^2*R^2) / (Pt*G^2*theta^2*PW*pi^3*K^2*TL);
	%Zmin_dB = 10*log10(Zmin*1e9);  % Convert m to mm^6/m^3
    % ^--- Rinehart's book. wrong version! (missing c in the denominator)

	% Zmin = (Pmin*1024*log(2)*lambda^2*R^2) / (Pt*G^2*theta^2*c*PW*pi^3*K^2*TL);
	
	Zmin = (radar.Pmin * 1024 * log(2) * radar.lambda ^ 2 * R ^ 2) / (radar.Pt * radar.G ^ 2 * radar.theta ^ 2 * c * radar.PW * pi ^ 3 * K ^ 2 * TL);
	Zmin_dB = 10 * log10(Zmin * 1e18);  % Convert m to mm^6/m^3
    Zmin_dB = Zmin_dB + cen;

	zz(ir, :) = (radar.Pmin * 1024 * log(2) * radar.lambda ^ 2 .* rr .^ 2) / (radar.Pt * radar.G ^ 2 * radar.theta ^ 2 * c * radar.PW * pi ^ 3 * K ^ 2 * TL);

	r_blind = c * radar.PW / 2;
	zz(ir, rr < r_blind - 250) = nan;  % Put a 250-m pad here for cosmetics
	
    if strfind(radar.name, 'Fill')
        [~, idx] = min(abs(rr - r_blind_prev));
        zz(ir, idx:end) = nan;
    end
    
    r_blind_prev = r_blind;

	fprintf('%30s : %6.2f dBZ (PW: %.2e, BR: %.0fm)\n', radar.name, Zmin_dB, radar.PW, radar.PW * c / 2);
end

%zz_db = 10*log10(1e9*zz); % <-- wrong version! (keep here for documentation purpose)
zz_db = 10*log10(1e18 * zz) + cen;
h = plot(1e-3 * rr, zz_db);
if strcmp(xscale, 'log')
    xx = 1.1;
else
    xx = 0.02*r;
end
ht = text(xx * ones(1,n), catlo(1:n) + 5, cat_str, 'Clipping', 'On');

% Use a mix of white and background color to create transparent look
for idx = 1:numel(ht)
	icolor = round(catlo(idx) / 5);
	set(ht(idx), 'Color', 0.7 * [1, 1, 1] + 0.3 * zmap(icolor, :));
end

set(ht,'HorizontalAlignment', 'Left');
grid on
xlabel('Range (km)')
ylabel('dBZ')
title(sprintf('Radar Sensitivity Matrix (lower is better) -  |K|^2 = %.3f (%s) ', K ^ 2, particle), 'Fontsize', 14);
text(r, ylim(2) + 0.05 * diff(ylim), sprintf('Created on %s', datestr(date)), 'HorizontalAlignment', 'Right', 'FontSize', 6)
xlim = [0, r];
set(gca, 'YDir', 'Normal', ...
    'YTick', -25:5:65, 'XLim', xlim, 'YLim', ylim, 'XScale', xscale, 'Color', 'None', 'Box', 'On');
set(hbg, 'YDir', 'Normal', 'YLim', ylim, 'Box', 'Off');
axis(hbg, 'off')

if label_odd_index_only
    legend(h(1:2:end), {radars(1:2:end).name})
else
    legend({radars.name})
end

if fig_brightnenss > 0.5
    blib('bsizewin', gcf, [800, 400])
	set(ht, 'Color', 'k')
else
	blib('bsizewin',gcf,[680, 480])
	set(ht, 'Color', 'w')
end

% Customize line attributes
for ir = 1:numel(radars)
	if ~isfield(radars(ir), 'attrib') || isempty(radars(ir).attrib), tmp = []; else, tmp = fieldnames(radars(ir).attrib); end
	for ia = 1:numel(tmp)
		%fprintf('%s %s\n', tmp{ia}, radars(ir).attrib.(tmp{ia}));
		set(h(ir), tmp{ia}, radars(ir).attrib.(tmp{ia}));
	end
end
